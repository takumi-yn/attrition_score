import streamlit as st
import pandas as pd
import numpy as np

# ================================
# é›¢è·äºˆå…†ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆAç¤¾å°‚ç”¨ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
# ================================
def calculate_attrition_score(inputs):
    score = 100

    # ã‚¹ã‚³ã‚¢ã‚’ä¸‹ã’ã‚‹è¦å› 
    if inputs.get("ãƒ‘ãƒ«ã‚¹ã‚µãƒ¼ãƒ™ã‚¤Q1_åå¿œ") == 1:
        score -= 15
    if inputs.get("å‹•æ©Ÿã¥ã‘åå¿œ") == 1:
        score -= 15
    if inputs.get("eNPSã‚¹ã‚³ã‚¢", 3) <= 2:
        score -= 10
    if inputs.get("æº€è¶³åº¦_åŠ´åƒæ¡ä»¶", 5) <= 3:
        score -= 10
    if inputs.get("æº€è¶³åº¦_äººé–“é–¢ä¿‚", 5) <= 3:
        score -= 10
    if inputs.get("æº€è¶³åº¦_æ‰¿èª", 5) <= 3:
        score -= 10
    if inputs.get("ãƒ‘ãƒ«ã‚¹ã‚µãƒ¼ãƒ™ã‚¤Q1æœªå›ç­”", 0) == 1:
        score -= 5
    if inputs.get("eNPSæœªå›ç­”", 0) == 1:
        score -= 5

    return max(min(score, 100), 0)

# ================================
# ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
# ================================
def generate_advice(inputs):
    messages = []
    if inputs.get("ãƒ‘ãƒ«ã‚¹ã‚µãƒ¼ãƒ™ã‚¤Q1_åå¿œ") == 1:
        messages.append("ğŸ“Œ ãƒ‘ãƒ«ã‚¹ã‚µãƒ¼ãƒ™ã‚¤Q1ãŒæœªå›ç­”ã‹ã‚‰å›ç­”ã‚ã‚Šã«å¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚æœ¬äººã®çŠ¶æ…‹å¤‰åŒ–ã®å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ãƒ’ã‚¢ãƒªãƒ³ã‚°ã‚’æ¨å¥¨ã—ã¾ã™ã€‚")
    if inputs.get("å‹•æ©Ÿã¥ã‘åå¿œ") == 1:
        messages.append("ğŸ“Œ å‹•æ©Ÿã¥ã‘è¦å› ã«å¯¾ã—ã¦åå¿œãŒè¦‹ã‚‰ã‚Œã¾ã—ãŸã€‚ä½•ã‹æ€ã†ã“ã¨ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚")
    if inputs.get("eNPSã‚¹ã‚³ã‚¢", 3) <= 2:
        messages.append("ğŸ“‰ eNPSã‚¹ã‚³ã‚¢ãŒä½ã„ãŸã‚ã€è·å ´ã¸ã®ä¸æº€ã‚„ä¸ä¿¡æ„ŸãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚")
    if inputs.get("æº€è¶³åº¦_åŠ´åƒæ¡ä»¶", 5) <= 3:
        messages.append("ğŸ’¬ åŠ´åƒæ¡ä»¶ã¸ã®æº€è¶³åº¦ãŒä½ã„ãŸã‚ã€æ¥­å‹™å†…å®¹ã‚„å¾…é‡é¢ã®ç¢ºèªãŒæœ‰åŠ¹ã§ã™ã€‚")
    if inputs.get("æº€è¶³åº¦_äººé–“é–¢ä¿‚", 5) <= 3:
        messages.append("ğŸ¤ äººé–“é–¢ä¿‚ã«æ‚©ã¿ãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚è·å ´å†…ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚")
    if inputs.get("æº€è¶³åº¦_æ‰¿èª", 5) <= 3:
        messages.append("ğŸ‘€ æ‰¿èªæ¬²æ±‚ãŒæº€ãŸã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚æˆæœã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒå±Šã„ã¦ã„ã‚‹ã‹ç¢ºèªã‚’ã€‚")
    if not messages:
        return "ç¾æ™‚ç‚¹ã§ã¯ç‰¹ã«ç›®ç«‹ã£ãŸé›¢è·ãƒªã‚¹ã‚¯è¦å› ã¯è¦‹ã‚‰ã‚Œã¾ã›ã‚“ã€‚å¼•ãç¶šãå®šæœŸçš„ãªãƒ•ã‚©ãƒ­ãƒ¼ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚"
    return "\n\n".join(messages)

# ================================
# Streamlit UI
# ================================
st.set_page_config(page_title="Aç¤¾æ§˜å°‚ç”¨ é›¢è·äºˆå…†ã‚¹ã‚³ã‚¢", page_icon="ğŸ”", layout="centered")
st.title("ğŸ” Aç¤¾æ§˜å°‚ç”¨ é›¢è·äºˆå…†ã‚¹ã‚³ã‚¢è¨ºæ–­")

st.header("ğŸ“‹ ã‚¹ã‚¿ãƒƒãƒ•æƒ…å ±ã®å…¥åŠ›")
col1, col2 = st.columns(2)

with col1:
    q1_react = st.selectbox("ãƒ‘ãƒ«ã‚¹ã‚µãƒ¼ãƒ™ã‚¤Q1ã®åå¿œã‚ã‚Š", ["ãªã—", "ã‚ã‚Š"])
    motive_react = st.selectbox("å‹•æ©Ÿã¥ã‘è¦å› ã®åå¿œã‚ã‚Š", ["ãªã—", "ã‚ã‚Š"])
    q1_missing = st.checkbox("ãƒ‘ãƒ«ã‚¹ã‚µãƒ¼ãƒ™ã‚¤Q1 æœªå›ç­”")
    enps_missing = st.checkbox("eNPS æœªå›ç­”")

with col2:
    enps_score = st.slider("eNPSã‚¹ã‚³ã‚¢ (1=æ¨å¥¨ã—ãªã„ã€œ5=å¼·ãæ¨å¥¨)", 1, 5, 3)
    cond_score = st.slider("æº€è¶³åº¦ï¼ˆåŠ´åƒæ¡ä»¶ï¼‰", 1, 5, 4)
    rel_score = st.slider("æº€è¶³åº¦ï¼ˆäººé–“é–¢ä¿‚ï¼‰", 1, 5, 4)
    ack_score = st.slider("æº€è¶³åº¦ï¼ˆæ‰¿èªï¼‰", 1, 5, 4)

if st.button("âœ… ã‚¹ã‚³ã‚¢ã‚’è¨ºæ–­ã™ã‚‹"):
    inputs = {
        "ãƒ‘ãƒ«ã‚¹ã‚µãƒ¼ãƒ™ã‚¤Q1_åå¿œ": 1 if q1_react == "ã‚ã‚Š" else 0,
        "å‹•æ©Ÿã¥ã‘åå¿œ": 1 if motive_react == "ã‚ã‚Š" else 0,
        "ãƒ‘ãƒ«ã‚¹ã‚µãƒ¼ãƒ™ã‚¤Q1æœªå›ç­”": int(q1_missing),
        "eNPSæœªå›ç­”": int(enps_missing),
        "eNPSã‚¹ã‚³ã‚¢": enps_score,
        "æº€è¶³åº¦_åŠ´åƒæ¡ä»¶": cond_score,
        "æº€è¶³åº¦_äººé–“é–¢ä¿‚": rel_score,
        "æº€è¶³åº¦_æ‰¿èª": ack_score
    }
    score = calculate_attrition_score(inputs)
    advice = generate_advice(inputs)

    st.subheader("ğŸ“Š é›¢è·äºˆå…†ã‚¹ã‚³ã‚¢")
    st.progress(score / 100)
    st.metric(label="ã‚¹ã‚³ã‚¢", value=f"{score} / 100")

    st.subheader("ğŸ’¡ ãŠã™ã™ã‚å¯¾å¿œ")
    st.success(advice)
